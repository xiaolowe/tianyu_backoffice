<#macro layout>
<!DOCTYPE html>
<html>
	<head>
		<base href="${CPATH}/">
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
		<meta charset="utf-8" />
		<title>众点WiFi运营管理平台</title>

		<meta name="description" content="" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0" />

		<link rel="SHORTCUT ICON" href="http://61.191.204.180:8002/group1/M00/00/04/CgA7AlVHMJWAOqjIAAAQt4Q9GeY934.png" /> 
		<!-- bootstrap & fontawesome -->
		<link rel="stylesheet" href="resources/css/bootstrap.min.css" />
		<link rel="stylesheet" href="resources/font-awesome/4.2.0/css/font-awesome.min.css" />
		
		<!-- page specific plugin styles -->
		<link rel="stylesheet" href="resources/css/bootstrapValidator.min.css" />
		<link rel="stylesheet" href="resources/css/jquery-ui.custom.min.css" />
		<link rel="stylesheet" href="resources/css/chosen.css" />
		<link rel="stylesheet" href="resources/css/datepicker.css" />
		<link rel="stylesheet" href="resources/css/bootstrap-timepicker.css" />
		<link rel="stylesheet" href="resources/css/daterangepicker.css" />
		
		<!-- text fonts -->
		<!-- <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Open+Sans:400,300" /> -->

		<!-- ace styles -->
		<link rel="stylesheet" href="resources/css/ace.min.css" id="main-ace-style"/>
		
		<!--[if lte IE 9]>
			<link rel="stylesheet" href="resources/css/ace-part2.min.css" />
		<![endif]-->
		<link rel="stylesheet" href="resources/css/ace-skins.min.css" />
		<link rel="stylesheet" href="resources/css/ace-rtl.min.css" />

		<!--[if lte IE 9]>
		  <link rel="stylesheet" href="resources/css/ace-ie.min.css" />
		<![endif]-->
		
		<!-- common styles -->
		<link rel="stylesheet" href="resources/css/common.css" />
		<link rel="stylesheet" href="resources/jquery-validation/css/screen.css" />
		
		<!-- ace settings handler -->
		<script src="resources/js/ace-extra.min.js"></script>

		<!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->

		<!--[if lt IE 9]>
		<script src="resources/js/html5shiv.js"></script>
		<script src="resources/js/respond.min.js"></script>
		<![endif]-->
		
		
		<!-- basic scripts -->

		<!--[if !IE]> -->
		<script src="resources/js/jquery/jquery-2.1.1.min.js"></script>
		<!-- <![endif]-->

		<!--[if IE]>
		<script src="resources/js/jquery/jquery-1.11.1.min.js"></script>
		<![endif]-->

		<!--[if !IE]> -->
		<script type="text/javascript">
			window.jQuery || document.write("<script src='resources/js/jquery.min.js'>"+"<"+"/script>");
		</script>
		<!-- <![endif]-->

		<!--[if IE]>
		<script type="text/javascript">
		 window.jQuery || document.write("<script src='resources/js/jquery1x.min.js'>"+"<"+"/script>");
		</script>
		<![endif]-->
		
		<script type="text/javascript">
			if('ontouchstart' in document.documentElement) document.write("<script src='resources/js/jquery.mobile.custom.min.js'>"+"<"+"/script>");
		</script>

		<script src="resources/bootstrap/3.2.0/js/bootstrap.min.js"></script>

		<!-- page specific plugin scripts -->
		<script src="resources/js/jquery.form.min.js"></script>
		<script src="resources/js/bootbox.min.js"></script>
		<script src="resources/js/bootstrapvalidator/bootstrapValidator.min.js"></script>
		<script src="resources/js/date-time/bootstrap-datepicker.min.js"></script>
		<script src="resources/js/date-time/bootstrap-timepicker.min.js"></script>
		<script src="resources/js/date-time/moment.min.js"></script>
		<script src="resources/js/date-time/daterangepicker.min.js"></script>
		<script src="resources/js/date-time/bootstrap-datepicker.zh-CN.js"></script>
		<script src="resources/js/date-time/bootstrap-datetimepicker.min.js"></script>

		<!-- ace scripts -->
		<script src="resources/js/ace-elements.min.js"></script>
		<script src="resources/js/ace.min.js"></script>
		
		<script src="resources/js/common.js"></script>		
		<script src="resources/kindeditor/kindeditor.js" type="text/javascript"></script>
		<script src="resources/kindeditor/lang/zh_CN.js" type="text/javascript"></script>
		
		<!--  add javascript -->
		<script type="text/javascript" src="resources/scripts/fileuploader.js"></script>
		<script language="javascript" src="resources/kindeditor/kindeditor.js" type="text/javascript"></script>
		<script language="javascript" src="resources/kindeditor/lang/zh_CN.js" type="text/javascript"></script>
		<script language="javascript" src="resources/jquery-validation/jquery.validate.js" type="text/javascript"></script>
		
	</head>

	<body class="no-skin">
		<div id="navbar" class="navbar navbar-default">
			<script type="text/javascript">
				try{ace.settings.check('navbar' , 'fixed')}catch(e){}
			</script>

			<div class="navbar-container" id="navbar-container">
				<button type="button" class="navbar-toggle menu-toggler pull-left" id="menu-toggler">
					<span class="sr-only">Toggle sidebar</span>

					<span class="icon-bar"></span>

					<span class="icon-bar"></span>

					<span class="icon-bar"></span>
				</button>

				<div class="navbar-header pull-left">
					<a href="dashboard" class="navbar-brand">
						<small>
							众点WiFi运营管理平台
						</small>
					</a>
				</div>

				<div class="navbar-buttons navbar-header pull-right" role="navigation">
					<ul class="nav ace-nav" >
					  <#if curRole != ADMINS>
						<li>
							<span class="user-info"  <#if curRole==ADMINS > <#else> style="display:none;" </#if>>
								<select id="areaId" onchange="getAreaInfo(this)"  style="width:100px;">
									<option value="">--请选择--</option>
									<#list areaList as x>
									<option value="${(x.codevalue)!''}"  <#if areaid?? && areaid=="${(x.codevalue)!''}"> selected </#if> >${(x.codename)!''}</option>
									</#list>
								</select>
							</span>&nbsp;&nbsp;
							<#if curRole==ADMINS >
							<span class="user-info">
								<select id="provinceId" style="width:100px;" onchange="getProvinceInfo(this)">
									<option value="">--请选择--</option>
								</select>
							</span>
							<#elseif curRole==AREAS>
							<span class="user-info">
								<select id="provinceId" style="width:100px;" onchange="getProvinceInfo(this)">
									<option value="">--请选择--</option> 
									<#list provinceList as province>
									<option value="${(province.regioncode!'')}" <#if provinceid?? && provinceid=="${(province.regioncode!'')}"> selected </#if> >${(province.regionname!"")}</option>
									</#list>
								</select>
							</span>
							</#if>
							&nbsp;&nbsp;
							<#if curRole==ADMINS || curRole==AREAS>
							<span class="user-info">
								<select id="cityId" style="width:100px;" onchange="getCityInfo(this)">
									<option value="">--请选择--</option>
								</select>
							</span>
							<#elseif curRole==PROVINCES>
							<span class="user-info">
								<select id="cityId" style="width:100px;" onchange="getCityInfo(this)">
									<option value="">--请选择--</option> 
									<#list cityList as city>
									<option value="${(city.regioncode!'')}" <#if cityid?? && cityid=="${(city.regioncode!'')}"> selected </#if> >${(city.regionname!"")}</option>
									</#list>
								</select>
							</span>
							</#if>
							&nbsp;&nbsp;
							<#if curRole==ADMINS || curRole==AREAS || curRole==PROVINCES>
							<span class="user-info">
								<select id="countiesId" style="width:100px;">
									<option value="">--请选择--</option>
								</select>
							</span>
							<#elseif curRole==CITYS>
							<span class="user-info">
								<select id="countiesId" style="width:100px;">
									<option value="">--请选择--</option> 
									<#list countiesList as counties>
									<option value="${(counties.regioncode!'')}" <#if countiesid?? && countiesid=="${(counties.regioncode!'')}"> selected </#if> >${(counties.regionname!"")}</option>
									</#list>
								</select>
							</span>
							</#if>
							<span class="user-info" style="margin-top:2px; <#if curRole==COUNTIES > display:none </#if>" >
								<a id="configBtn" href="" class="btn btn-xs btn-warning" onclick="areaConfig()">
									<i class="ace-icon fa fa-building align-top"></i>设定区域
								</a>
							</span>&nbsp;&nbsp;
							<span class="user-info" style="margin-top:2px; max-width: 500px; <#if curRole==COUNTIES > display:none </#if> " >
								<span   class="label label-sm label-warning" style="line-height:1.5; height: 25px;">
									${invitecode!''}
								</span>
							</span>&nbsp;&nbsp;
						</li>
						</#if>
						<li class="light-blue">
							<a data-toggle="dropdown" href="#" class="dropdown-toggle">
								<img class="nav-user-photo" src="resources/avatars/avatar.png" alt="你的头像" />
								<span class="user-info">
									<small>欢迎,</small>
									${loginName!'无名氏'}
								</span>

								<i class="ace-icon fa fa-caret-down"></i>
							</a>

							<ul class="user-menu dropdown-menu-right dropdown-menu dropdown-yellow dropdown-caret dropdown-close">
								<li>
									<a href="sysUser/account">
										<i class="ace-icon fa fa-user"></i>
										修改密码
									</a>
								</li>

								<li class="divider"></li>

								<li>
									<a id="logout" href="#" >
										<i class="ace-icon fa fa-power-off"></i>
										退出登录
									</a>
								</li>
							</ul>
						</li>
					</ul>
				</div>
			</div><!-- /.navbar-container -->
		</div>

		<div class="main-container" id="main-container">
			<script type="text/javascript">
				try{ace.settings.check('main-container' , 'fixed')}catch(e){}
			</script>

			<div id="sidebar" class="sidebar                  responsive">
				<script type="text/javascript">
					try{ace.settings.check('sidebar' , 'fixed')}catch(e){}
				</script>

				<ul class="nav nav-list">
					<#list menu as x>
						<#if x.subMenu.size() &gt; 0>
						<#if x.action = action>
						<li class="active open hsub">
						<#else>
						<li class="">
						</#if>
							<a class="dropdown-toggle" href="#" >
							<i class="menu-icon fa ${x.icon}"></i>
								<span class="menu-text">${x.title}</span>
								<b class="arrow fa fa-angle-down"></b>
							</a>
							<ul class="submenu">
								<#list x.subMenu as y>
								<#if y.uri = currentUri || (y.uri = "myRouter/bwList" && currentUri="myRouter/domainList")
								|| (y.uri = "myRouter/bwList" && currentUri="myRouter/importBwlist")>
									<li class="active">
								<#else>
									<li>
								</#if>
									<a href="${y.uri}">
									<i class="menu-icon fa ${y.icon}"></i>
									<span class="menu-text">${y.title}</span>
									</a>
								</li>
								</#list>
							</ul>
						<#else>
							<#if x.action = action>
							<li class="active">
							<#else>
							<li class="">
							</#if>
							<a class="" href="${x.links}" >
							<i class="menu-icon fa ${x.icon}"></i>
								<span class="menu-text">${x.title}</span>
							</a>
						</#if>
					</li>
					</#list>
				</ul><!-- /.nav-list -->

				<div class="sidebar-toggle sidebar-collapse" id="sidebar-collapse">
					<i class="ace-icon fa fa-angle-double-left" data-icon1="ace-icon fa fa-angle-double-left" data-icon2="ace-icon fa fa-angle-double-right"></i>
				</div>

				<script type="text/javascript">
					try{ace.settings.check('sidebar' , 'collapsed')}catch(e){}
				</script>
			</div>

			<div class="main-content">
				<div class="breadcrumbs" id="breadcrumbs">
					<script type="text/javascript">
						try{ace.settings.check('breadcrumbs' , 'fixed')}catch(e){}
					</script>

					<ul class="breadcrumb">
						<#list breadcrumb as x>
							<li>
								<#if x.icon??>
								<i class="ace-icon fa ${x.icon}"></i>
								</#if>
								<span>${x.title}</span>
							</li>
						</#list>
					</ul><!-- /.breadcrumb -->
				</div>

				<div class="page-content">
					<div class="ace-settings-container" id="ace-settings-container">
						<div class="btn btn-app btn-xs btn-warning ace-settings-btn" id="ace-settings-btn">
							<i class="ace-icon fa fa-cog bigger-150"></i>
						</div>

						<div class="ace-settings-box clearfix" id="ace-settings-box">
							<div class="pull-left width-50">
								<div class="ace-settings-item">
									<div class="pull-left">
										<select id="skin-colorpicker" class="hide">
											<option data-skin="no-skin" value="#438EB9">#438EB9</option>
											<option data-skin="skin-1" value="#222A2D">#222A2D</option>
											<option data-skin="skin-2" value="#C6487E">#C6487E</option>
											<option data-skin="skin-3" value="#D0D0D0">#D0D0D0</option>
										</select>
									</div>
									<span>&nbsp; 选择皮肤</span>
								</div>

								<div class="ace-settings-item">
									<input type="checkbox" class="ace ace-checkbox-2" id="ace-settings-navbar" />
									<label class="lbl" for="ace-settings-navbar"> 固定导航栏</label>
								</div>

								<div class="ace-settings-item">
									<input type="checkbox" class="ace ace-checkbox-2" id="ace-settings-sidebar" />
									<label class="lbl" for="ace-settings-sidebar"> 固定侧边栏</label>
								</div>

								<div class="ace-settings-item">
									<input type="checkbox" class="ace ace-checkbox-2" id="ace-settings-breadcrumbs" />
									<label class="lbl" for="ace-settings-breadcrumbs"> 固定面包屑</label>
								</div>

								<div class="ace-settings-item">
									<input type="checkbox" class="ace ace-checkbox-2" id="ace-settings-rtl" />
									<label class="lbl" for="ace-settings-rtl"> 左右调换</label>
								</div>

								<div class="ace-settings-item">
									<input type="checkbox" class="ace ace-checkbox-2" id="ace-settings-add-container" />
									<label class="lbl" for="ace-settings-add-container">
										窄屏显示
									</label>
								</div>
							</div><!-- /.pull-left -->

							<div class="pull-left width-50">
								<div class="ace-settings-item">
									<input type="checkbox" class="ace ace-checkbox-2" id="ace-settings-hover" />
									<label class="lbl" for="ace-settings-hover"> 悬停子菜单</label>
								</div>

								<div class="ace-settings-item">
									<input type="checkbox" class="ace ace-checkbox-2" id="ace-settings-compact" />
									<label class="lbl" for="ace-settings-compact"> 精简侧边栏</label>
								</div>

								<div class="ace-settings-item">
									<input type="checkbox" class="ace ace-checkbox-2" id="ace-settings-highlight" />
									<label class="lbl" for="ace-settings-highlight"> 高亮显示选中项</label>
								</div>
							</div><!-- /.pull-left -->
						</div><!-- /.ace-settings-box -->
					</div><!-- /.ace-settings-container -->

					<div class="page-content-area">
						<#if infoMsg??>
						<div class="alert alert-block alert-success">
							<button data-dismiss="alert" class="close" type="button"><i class="ace-icon fa fa-times"></i></button>
							${infoMsg!''}
						</div>
						</#if>
						<#if errorMsg??>
						<div class="alert alert-block alert-danger">
							<button data-dismiss="alert" class="close" type="button"><i class="ace-icon fa fa-times"></i></button>
							${errorMsg!''}
						</div>
						</#if>
						
						<div class="row">
							<div class="col-xs-12">
								<!-- PAGE CONTENT BEGINS -->
								<#nested>
								<!-- PAGE CONTENT ENDS -->
							</div><!-- /.col -->
						</div><!-- /.row -->
					</div><!-- /.page-content-area -->
				</div><!-- /.page-content -->
			</div><!-- /.main-content -->

			<div class="footer">
				<div class="footer-inner">
					<div class="footer-content">
						<span class="bigger-120">
							<span class="blue bolder">深圳众点移动互联有限公司</span>
							 &copy; 2014-2015
						</span>
					</div>
				</div>
			</div>

			<a href="#" id="btn-scroll-up" class="btn-scroll-up btn btn-sm btn-inverse">
				<i class="ace-icon fa fa-angle-double-up icon-only bigger-110"></i>
			</a>
		</div><!-- /.main-container -->
		
		<div class="modal fade" id="modal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
		  <div class="modal-dialog">
		    <div class="modal-content">
		
		    </div><!-- /.modal-content -->
		  </div><!-- /.modal-dialog -->
		</div><!-- /.modal -->

		<!-- inline scripts related to this page -->
		<script type="text/javascript">
		jQuery(function($) {
			$('#logout').click(function(){
				bootbox.confirm("您确定要退出吗？", function(result) {
					if(result) {
						$.ajax({
				            url: 'site/logout',
				            success : function(){
				            	window.location.href = "${CPATH}/site/index";
				            }
				        });
					}
				});
				return false;
			});
			$.ajaxSetup({cache:false})
		});
		jQuery(function($) {
			var provincecode = "${(provinceid)!''}";
			var citycode = "${(cityid)!''}";
			var countiescode = "${(countiesid)!''}";
			
			var adminStr = "${(ADMINS)!''}";
			var areaStr = "${(AREAS)!''}";
			var provinceStr = "${(PROVINCES)!''}";
			var cityStr = "${(CITYS)!''}";
			var userrole = "${(curRole)!''}";
			
			if(userrole==adminStr){
				//加载省份选择框
				commonAjax("areaId", "provinceId", "site/getProvinceList", "areaid", provincecode);
				//加载城市选择框
				commonAjax("provinceId", "cityId", "site/getCityList", "provinceid", citycode);
				//加载区县选择框
				commonAjax("cityId", "countiesId", "site/getCountiesList", "countiesid", countiescode);
			}
			if(userrole==areaStr){
				
				//加载城市选择框
				commonAjax("provinceId", "cityId", "site/getCityList", "provinceid", citycode);
				//加载区县选择框
				commonAjax("cityId", "countiesId", "site/getCountiesList", "countiesid", countiescode);
			}
			if(userrole==provinceStr){
				//加载区县选择框
				commonAjax("cityId", "countiesId", "site/getCountiesList", "countiesid", countiescode);
			}
			
		});
//设置区域后
function commonAjax(curSelId, nexSelId, urlStr, formArgs, nexSelValue){
	var curselectvalue = $('#'+curSelId).val();
	if(curselectvalue != "") {
		$('#'+nexSelId).empty();
		var selObj = $('#'+nexSelId);
		selObj.append('<option value="">--请选择--</option>');
		
		$.ajax({
			type : "post",
			url : urlStr,
			async: false,
			data : formArgs+"="+curselectvalue,
			dataType : "json",
			success : function(data) {
				$.each(data, function(key, item) {
					if(item.regioncode == nexSelValue) {
						selObj.append('<option value="'+item.regioncode+'" selected="selected">' + item.regionname + '</option>');
					} else {
						selObj.append('<option value="'+item.regioncode+'">'+ item.regionname + '</option>');
					}
					
				});
			}
		});
	}
}

//设置区域前
function getSelValue(nextSelObjId, urlStr, formArg, curSelObj){
	$('#'+nextSelObjId).empty();
	var nextSelect = $('#'+nextSelObjId);
	
	nextSelect.append('<option value="">--请选择--</option>');
	if(curSelObj.value != "") {
		$.ajax({
			type : "post",
			url : urlStr,
			data : formArg+"="+curSelObj.value,
			dataType : "json",
			success : function(data) {
				$.each(data, function(n, data) {
					nextSelect.append('<option value="'+data.regioncode+'">' + data.regionname + '</option>');
				});
			}
		});
	}
}
function getAreaInfo(areaInfo){
	
	getSelValue("provinceId", "site/getProvinceList", "areaid", areaInfo);
	
	getProvinceInfo({value:""});
	getCityInfo({value:""});
}
function getProvinceInfo(provinceInfo){
	
	getSelValue("cityId", "site/getCityList", "provinceid", provinceInfo);
	
	getCityInfo({value:""});
}
function getCityInfo(cityInfo){
	
	getSelValue("countiesId", "site/getCountiesList", "countiesid", cityInfo);
}

function getProvinceInfo2(){
	
}

function areaConfig(){
	var currentUri = "/"+"${currentUri}";
	var areaid = $("#areaId").val();
	var provinceid = "";
	var cityid = "";
	var countiesid = $("#countiesId").val();
	
	//大区用户
	if(${curRole}==${AREAS}||${curRole}==${ADMINS}){
		provinceid = $("#provinceId").val();
		cityid = $("#cityId").val();
	}
	//省级用户
	if(${curRole}==${PROVINCES}){
		cityid = $("#cityId").val();
	}
	
	$("#configBtn").attr("href","site/setAreaToSession?areaid="+areaid+"&provinceid="+provinceid+"&cityid="+cityid+"&countiesid="+countiesid+"&curUri="+currentUri);
	
}
		</script>
	</body>
</html>
</#macro>
